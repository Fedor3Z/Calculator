From 84c7a7b7b5aa821fbab92da166015c8ac7cac54f Mon Sep 17 00:00:00 2001
From: bot <bot@example.com>
Date: Mon, 9 Feb 2026 19:50:07 +0000
Subject: [PATCH] Add hover tooltips for ? help icons (code mapping)

---
 app/ui_mainwindow.py | 83 ++++++++++++++++++++++++++++++++++++++++++--
 1 file changed, 81 insertions(+), 2 deletions(-)

diff --git a/app/ui_mainwindow.py b/app/ui_mainwindow.py
index 2917994..4a4ae40 100644
--- a/app/ui_mainwindow.py
+++ b/app/ui_mainwindow.py
@@ -48,6 +48,82 @@ from storage.projects import ProjectData, ProjectStorage
 from storage.recents import RecentProjects
 
 
+# Пояснения для параметров (показываются при наведении на '?' в кружочке).
+# Ключи — ровно то, что выводится в лейбле параметра (например: "D1", "Q'", "Tогранич").
+PARAM_TOOLTIPS: Dict[str, str] = {
+    "D1": "Диаметр ведущего шкива.",
+    "D2": "Диаметр ведомого шкива.",
+    "n1": "Частота вращения ведущего шкива.",
+    "P": "Мощность электродвигателя.",
+    "Q'": "Результирующая нагрузка от ременной передачи при установке на комбайне.",
+    "M'": "Крутящий момент на валу при работе в поле.",
+    "Sэл": "Стоимость электроэнергии.",
+    "L": "Длина ремня.",
+    "b1": "Высота установки ведущего шкива от пола.",
+    "b2": "Высота установки ведомого шкива от пола.",
+    "μ": "Коэффициент трения между шкивом и ремнем.",
+    "kрем": "Жесткость ремня.",
+    "Fпров": "Сила проверки натяжения ремня.",
+    "L1": "Длина меньшего плеча рычага.",
+    "L2": "Длина большего плеча рычага.",
+    "s2": "Расстояние между ведомым шкивом и подшипником нагружения.",
+    "s3": "Расстояние между подшипником нагружения и подшипниковой опорой барабана.",
+    "s4": "Расстояние между подшипниковыми опорами барабана.",
+    "Se": "Предел выносливости при симметричном цикле нагружения.",
+    "σв": "Временное сопротивление разрыву.",
+    "ks": (
+        "Коэффициент состояния поверхности (чем грубее поверхность, тем ниже выносливость):\n"
+        "• шлифованная/полированная: 0,85…1,00\n"
+        "• чистовая мехобработка: 0,75…0,90\n"
+        "• грубая мехобработка: 0,65…0,80\n"
+        "• прокат/ковка (без обработки): 0,45…0,70"
+    ),
+    "kr": (
+        "Коэффициент размера (крупные диаметры/сечения дают меньшую выносливость):\n"
+        "• малые диаметры (условно до ~10 мм): ~1,0\n"
+        "• 20…50 мм: 0,8…0,95\n"
+        "• 50…200+ мм: 0,6…0,8"
+    ),
+    "kt": (
+        "Температурный коэффициент (учитывает снижение выносливости при повышенной температуре):\n"
+        "• до ~100 °C: ~1,0\n"
+        "• 150…250 °C: 0,9…1,0\n"
+        "• 300…400 °C: 0,7…0,9"
+    ),
+    "krel": (
+        "Коэффициент надёжности (вероятности безотказной работы по выносливости).\n"
+        "Чем выше требуемая надёжность, тем меньше допустимая выносливость:\n"
+        "• 50%: 1,00\n"
+        "• 90%: 0,90\n"
+        "• 95%: 0,87\n"
+        "• 99%: 0,81\n"
+        "• 99,9%: 0,75"
+    ),
+    "kf": (
+        "Коэффициент усталостной концентрации напряжений (учитывает геометрический концентратор + "
+        "чувствительность материала к надрезу):\n"
+        "• гладкая деталь без надрезов: 1,0\n"
+        "• плавные переходы/галтели: 1,1…1,6\n"
+        "• шпоночные пазы/резкие уступы: 1,6…3,0\n"
+        "• очень острые надрезы: до 4…5+ (реже в “нормальном” машиностроении)"
+    ),
+    "Fр": "Преднатяжение ветвей ремня.",
+    "D1min": "Минимальный диаметр ведущего шкива.",
+    "D1max": "Максимальный диаметр ведущего шкива.",
+    "D2min": "Минимальный диаметр ведомого шкива.",
+    "D2max": "Максимальный диаметр ведомого шкива.",
+    "n1min": "Минимальная частота вращения ведущего шкива.",
+    "n1max": "Максимальная частота вращения ведущего шкива.",
+    "Fpmin": "Минимальное преднатяжение ветвей ремня.",
+    "Fpmax": "Максимальное преднатяжение ветвей ремня.",
+    "Tогранич": "Максимальное натяжение ветви ремня.",
+    "Sнач": "Начальная стоимость испытаний (можно взять после 1-го расчета).",
+    "Fнач": "Начальная требуемая внешняя радиальная сила (можно взять после 1-го расчета).",
+    "wст": "Вес начальной стоимости испытаний (для оптимизации).",
+    "wF": "Вес начальной требуемой внешней радиальной силы (для оптимизации).",
+}
+
+
 @dataclass
 class UiState:
     project_path: Optional[Path] = None
@@ -347,7 +423,8 @@ class MainWindow(QMainWindow):
                 if not name:
                     name = cell_norm
 
-                help_text = (item.description or "").strip() or "Пояснение не задано."
+                # Пояснения берём либо из JSON (item.description), либо из встроенной карты PARAM_TOOLTIPS.
+                help_text = (item.description or "").strip() or PARAM_TOOLTIPS.get(name, "").strip() or "Пояснение не задано."
                 unit_text = (item.unit or "").strip()
                 if unit_text.startswith("="):
                     unit_text = ""
@@ -364,7 +441,9 @@ class MainWindow(QMainWindow):
                 help_btn = QPushButton()
                 help_btn.setFlat(True)
                 help_btn.setIcon(QApplication.style().standardIcon(QStyle.SP_MessageBoxQuestion))
-                help_btn.setToolTip("Пояснение")
+                # Пояснение показываем сразу при наведении.
+                # (Клик оставляем: открывает окно с тем же текстом.)
+                help_btn.setToolTip(help_text)
                 help_btn.setFixedSize(22, 22)
                 help_btn.clicked.connect(
                     lambda _=False, t=help_text, ttl=name: QMessageBox.information(self, ttl or "Пояснение", t)
-- 
2.39.5

